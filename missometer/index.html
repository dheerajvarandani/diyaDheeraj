<html>

<head></head>

<body>
    
<style>



    #threejscanvas {

        width: 100vw;
        height: 90vh;
      border: solid 1px white;
      margin:0;
    }
</style>


<canvas id="threejscanvas" width="100%"></canvas>

<input type="range" min=0 max=160 value=0 id="aortaSlider" style="position:absolute; top: 5vh; left: 10vw;">
<div style="position:absolute; top: 10vh; left: 10vw;">
  <input type="checkbox" id="hideLbl"  checked>
<label id="labelsLabel" for="hideLbl" style="color:white; font-size: 13px; font-family: Arial, Helvetica, sans-serif;">Labels</label>
</div>
  <div id="loadingDiv">Loading...</div>
  
<script type="importmap">

    {
        "imports": {
            "three": "./three/build/three.module.js"
        }
    }
</script>
<script type="module">

    import * as THREE from 'three';
    import { GLTFLoader } from "./three/GLTFLoader.js";
    import { OrbitControls } from './three/OrbitControls.js';
    import { RGBELoader } from './three/RGBELoader.js';
  
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
    const container = document.getElementById("threejscanvas")

    const renderer = new THREE.WebGLRenderer({canvas: container});
    renderer.setSize( container.clientWidth, container.clientHeight );
    //document.body.appendChild( renderer.domElement );

    const controls = new OrbitControls( camera, renderer.domElement );

    const light = new THREE.AmbientLight( 0x404040 ); // soft white light
    scene.add( light );

    const directionalLight = new THREE.DirectionalLight( 0xffffff, 0.5 );
    scene.add( directionalLight );

    const light2 = new THREE.HemisphereLight( 0xffffbb, 0x080820, 1);
    scene.add( light2 );     

    let missometer;
    let aortaAnim;
    let mixer;
  let labels = [];
  
    camera.position.z = 2;
        camera.position.y = 1;

    var clock = new THREE.Clock()
    var delta = clock.getDelta();

    var needle;
  
    // ---------------------------------------------------------------------
    // HDRI - IMAGE BASED LIGHTING
    // ---------------------------------------------------------------------
    new RGBELoader()
    .setPath('./assets/')
    .load('brown_photostudio_01_2k.hdr', function (texture) {

        
        texture.mapping = THREE.EquirectangularReflectionMapping;

        

        
        //scene1.background = texture;
        scene.background = new THREE.Color( "rgb(1,22,45)" );
        scene.environment = texture;
        scene.environment.rotation = 180

    });
  
var loadingManager = new THREE.LoadingManager();

  loadingManager.onLoad = function() {
document.getElementById("loadingDiv").innerHTML = "Loaded!";    }


  loadingManager.onError = function(item){
    document.getElementById("loadingDiv").innerHTML = "Error: " + item }
  

const loader = new GLTFLoader(loadingManager);
loader.load(
	// resource URL
	'./assets/missometer.glb',
  //'https://storage.googleapis.com/dheerajv-bucket/images/aorta.glb',
	// called when the resource is loaded
	function ( gltf ) {


        missometer = gltf.scene;
        aortaAnim = gltf.animations;
		scene.add( missometer);

        mixer = new THREE.AnimationMixer(missometer);

        needle = missometer.getObjectByName("needle")

        mixer.clipAction(aortaAnim[0]).time = 0;
        mixer.clipAction(aortaAnim[0]).play();
        //console.log(mixer.clipAction(aortaAnim[0]))
            labels = [
    missometer.getObjectByName("supraceliacAorta"), //0,1 ( key + key - 1)
    missometer.getObjectByName("supraCeliacAorta_line1"), //1,1 (key + key - 2)
    missometer.getObjectByName("renalArtery"), //2,2
    missometer.getObjectByName("renalArtery_line1"), //3,2
    missometer.getObjectByName("commonIliac"), //4,3
    missometer.getObjectByName("commonIliac_line1"), //5,3
    missometer.getObjectByName("internalIliac"), //6,4
    missometer.getObjectByName("internalIliac_line1"), //7,4
    missometer.getObjectByName("thoracicAorta"),//8,5
    missometer.getObjectByName("thoracicAorta_line1"),//9,5
    missometer.getObjectByName("celiacTrunk"),//10
    missometer.getObjectByName("celiacTrunk_line1"),//11
    missometer.getObjectByName("infrarenalAorta"),//12
    missometer.getObjectByName("infrarenalAorta_line1"),//13
    missometer.getObjectByName("distalAorta"),//14
    missometer.getObjectByName("distalAbdominalAorta_line1"),//15
    missometer.getObjectByName("externalIliac"),//16
    missometer.getObjectByName("external_Iliac_line1")//17

    ]

	});




document.getElementById("hideLbl").addEventListener("click", function(){




    if(!this.checked){
        for(var i = 0; i < labels.length; i++){

            labels[i].visible = false;

        }
    }
    else{
        for(var i = 0; i < labels.length; i++){

        labels[i].visible = true;

        }

    }
})

  document.onkeydown = function(e){

if(e.key >= 1 && e.key <=9){

   var key = parseInt(e.key)

   var label_text = labels[key + key - 2]
   var label_line = labels[key + key - 1]

    if(label_text.visible == true){
    label_text.visible = false;
    label_line.visible = false;
    }
    else{
    label_text.visible = true;
    label_line.visible = true;

    }
}
  }

    function animate() {
        requestAnimationFrame( animate );
        needle.rotation.z -= 0.1
        if(mixer){
            mixer.update(delta);
        }
        renderer.render( scene, camera );

    }
    animate();

    var slider = document.getElementById("aortaSlider").addEventListener("input",function(){

        mixer.clipAction(aortaAnim[0]).stop();
        mixer.clipAction(aortaAnim[0]).time = this.value/10;
        mixer.clipAction(aortaAnim[0]).play();

    })

</script>

</body>
</html>